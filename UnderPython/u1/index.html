
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../u2/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>A Modern Python Packaging Guide - Roy's Secret Garden</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#a-modern-python-packaging-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Roy&#39;s Secret Garden" class="md-header__button md-logo" aria-label="Roy's Secret Garden" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Roy's Secret Garden
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              A Modern Python Packaging Guide
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/Roy-Kid" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Roy-Kid
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Skiing/" class="md-tabs__link">
          
  
  Skiing

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  UnderPython

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Roy&#39;s Secret Garden" class="md-nav__button md-logo" aria-label="Roy's Secret Garden" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Roy's Secret Garden
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Roy-Kid" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Roy-Kid
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Home
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Curriculum Vitae
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Skiing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Skiing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Skiing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Something About Skiing...
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Skiing/roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Skiing Skill Roadmap
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    UnderPython
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            UnderPython
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    A Modern Python Packaging Guide
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    A Modern Python Packaging Guide
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#about-project-structure" class="md-nav__link">
    <span class="md-ellipsis">
      About project structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#about-setuptools" class="md-nav__link">
    <span class="md-ellipsis">
      About setuptools
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#write-and-test" class="md-nav__link">
    <span class="md-ellipsis">
      Write and Test
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hybrid-python-and-cpp" class="md-nav__link">
    <span class="md-ellipsis">
      Hybrid python and cpp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../u2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Implicit Type Conversion
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#about-project-structure" class="md-nav__link">
    <span class="md-ellipsis">
      About project structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#about-setuptools" class="md-nav__link">
    <span class="md-ellipsis">
      About setuptools
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#write-and-test" class="md-nav__link">
    <span class="md-ellipsis">
      Write and Test
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hybrid-python-and-cpp" class="md-nav__link">
    <span class="md-ellipsis">
      Hybrid python and cpp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="a-modern-python-packaging-guide">A Modern Python Packaging Guide</h1>
<p>Packaging is a tedious and dirty job for python developers. The python packaging ecosystem is a mess, and full of historical burdens. You might confused with the different tools and command-line interfaces, and suffer from decision paralysis when it comes to choosing project structures, configuration files, and packaging tools. In the guide, I will give you a brife introduction from create a repo of github to pulish it to pypi and conda in a dictatorial manner.</p>
<p>Up to now, many of python scaffolds have emerged. They provide very convenient ways to create a python project, let developer rid of tiresome configuration. However, under hook, They assist you in using underlying tools such as <code>setuptools</code>. Once you want to customize your project, you will find that you have to learn the underlying tools. So, In the guide, an example project will build up from scratch, rely on less dependencies as possible.</p>
<p>To make the guide more readable, I will use a simple project as an example. </p>
<p>Before we start, we should think what structure of our project choose.</p>
<h2 id="about-project-structure">About project structure</h2>
<p>Two popular project layouts are used in python project, each one with its own set of pros and cons<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>[^2]. The first one is called <code>flat-layout</code>, also known as <em>adhoc</em>. The package folders are placed directly under the project root like this:</p>
<pre><code>project_root_directory
├── pyproject.toml  # AND/OR setup.cfg, setup.py
├── ...
├── mypkg/
|   ├── __init__.py
|   ├── ...
|   ├── module.py
|   ├── subpkg1/
|   │   ├── __init__.py
|   │   ├── ...
|   │   └── module1.py
|   └── subpkg2/
|       ├── __init__.py
|       ├── ...
|        └── module2.py
└── tests/
    ├── __init__.py
    ├── ...
    └── test_mypkg.py
</code></pre>
<p>This layout is very common and practical for using the REPL, but in some situations it can be more error-prone (e.g. during tests or if you have a bunch of folders or Python files hanging around your project root). The structure will bring up a problem: You get <strong>import parity</strong>. The current directory(e.g. root dir) is implicitly included in <code>sys.path</code>; but not so when installing &amp; importing from site-packages. Users will never have the same current working directory as you do. For example, once you import the project in the tests in such way: <code>import mypkg</code>, it will not import the project in the site-packages but the current directory. So, more people are consider about the second layout, <code>src-layout</code> like this:</p>
<pre><code>project_root_directory
├── pyproject.toml  # AND/OR setup.cfg, setup.py
├── ...
└── src/  # NOTE: no __init__.py
    └── mypkg/  
        ├── __init__.py
        ├── ...
        ├── module.py
        ├── subpkg1/
        │   ├── __init__.py
        │   ├── ...
        │   └── module1.py
        └── subpkg2/
            ├── __init__.py
            ├── ...
            └── module2.py
</code></pre>
<p>In this layout, the package <code>mypkg</code> is under <code>src</code> directory, and the <code>src</code> directory is not a package (no <code>__init__.py</code>). This constraint has beneficial implications in both testing and packaging: </p>
<ol>
<li>
<p>You will be forced to install the package and test the installed code (e.g.: by installing in a virtualenv). This will ensure that the deployed code works (it's packaged correctly) - otherwise your tests will fail. </p>
</li>
<li>
<p>It prevents you from readily importing your code in the <code>setup.py</code> script. This is a bad practice because it will always blow up if importing the main package or module triggers additional imports for dependencies (which may not be available). </p>
</li>
<li>
<p>Simpler packaging code and manifest. Without <code>src</code> you get messy editable installs (<code>setup.py develop</code> or <code>pip install -e</code>). Having no separation (no <code>src</code> dir) will force setuptools to put your project's root on <code>sys.path</code> - with all the junk in it.</p>
</li>
<li>
<p>Less chance for tools to mixup code with non-code.</p>
</li>
</ol>
<p>Also, you will notice that we not include tests in the <code>src</code> or packages because tests are concerned with development, not usage. It require addtional dependencies to run. Module discovery tools will trip over your test modules. </p>
<div class="admonition note">
<p class="admonition-title">module, package and namespace</p>
<p>Package, module, and namespace are three different concepts in Python:</p>
<ol>
<li>
<p>Module: A module is a file containing Python code. It can define functions, classes, and variables, which can be used in other modules or scripts. Modules can be imported into other modules or scripts using the import statement.</p>
</li>
<li>
<p>Package: A package is a collection of modules. It is a way to organize related modules together. A package is represented by a directory containing an <code>__init__.py</code> file and can contain other modules or sub-packages.</p>
</li>
<li>
<p>Namespace: A namespace is a mapping between names and objects. It is used to avoid naming conflicts between different modules or packages. Namespaces can be created using the global statement, or by defining functions, classes, or modules. </p>
</li>
</ol>
<p>In summary, a module is a file containing Python code, a package is a collection of related modules, and a namespace is a mapping between names and objects that helps avoid naming conflicts. We will invoke the namespace in the following sections.</p>
</div>
<h2 id="about-setuptools">About setuptools</h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I rewrite the project as a template so it can be used as a scaffold for future project. The file and function name may be different with this tutorial, but the structure keep unchanged.</p>
</div>
<p>After understanding the structure, we can create our example project. We will first package the pure python code, install and test it, which ensure that our configuration is correct. Next, we will introduce extra building system to hybrid C++ or others. Our project will be named <code>mypkg</code>, and the structure is like this:</p>
<pre><code>├── pyproject.toml  # and/or setup.cfg
├── setup.py
├── README.md  # ...and other optional declearation
├── src
│   └── mypkg
│       ├── __init__.py
│       ├── ...
│       └── module.py
└── tests
    ├── __init__.py
    ├── ...
    └── test_mypkg.py
</code></pre>
<p>Two new files are include in our project: <code>pyproject.toml</code> and <code>setup.py</code>. <code>pyproject.toml</code> is a static configuration file, and the distribution can then be generated with any packaging tools.</p>
<div class="admonition info">
<p class="admonition-title">distribution and wheel</p>
<p>Source distribution(aka. <code>sdist</code>) provides metadata and the essential source files needed for installing by a tool like <code>pip</code>, or for generating a Built distribution. It only need to be moved to the correct location on the target system.</p>
<p>Built distribution(aka. <code>wheel</code>) requires a build step before it can be installed. This format does not imply that Python files have to be precompiled (Wheel intentionally does not include compiled Python files).</p>
</div>
<p>First we should declear the metadata of our project in <code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[project]
name = &quot;my_proj&quot;
authors = [
    {name = &quot;Roy Kid&quot;, email = &quot;lijichen365@gmail.com&quot;},
]
description = &quot;My package description&quot;
readme = &quot;README.rst&quot;
requires-python = &quot;&gt;=3.7&quot;
keywords = [&quot;one&quot;, &quot;two&quot;]
license = {text = &quot;BSD-3-Clause&quot;}
classifiers = [
    &quot;Programming Language :: Python :: 3&quot;,
]
dependencies = [
    'importlib-metadata; python_version&lt;&quot;3.8&quot;',
]
</code></pre>
<p>Next, we need to designate <code>build-system</code> requirements and the build backend:</p>
<pre><code class="language-toml">[build-system]
requires = [&quot;setuptools&quot;, &quot;setuptools-scm[toml]&quot;]
build-backend = &quot;setuptools.build_meta&quot;
</code></pre>
<p>Note that <code>setuptools-scm</code> is a plugin for setuptools that  enables setuptools to get metadata and a list of files from SCM (Source Code Management, e.g. <code>git</code> or <code>hg</code>). In this way we avoid to write <code>MINIFEST.in</code> to determine which files to include in the source distribution. If we do not use <code>setuptools-scm</code>, we also can specify the files to include in the source distribution in <code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[tool.setuptools.packages]
find = {}  # Scan the project directory with the default parameters

# OR
[tool.setuptools.packages.find]
# All the following settings are optional:
where = [&quot;src&quot;]  # [&quot;.&quot;] by default
# include = [&quot;mypackage*&quot;]  # [&quot;*&quot;] by default
# exclude = [&quot;mypackage.tests*&quot;]  # empty by default
namespaces = false  # true by default
</code></pre>
<div class="admonition warning">
<p class="admonition-title">non-py file may not include</p>
<p>As mentioned above, the source distribution only need to include the essential source files needed for installing. So if we want to include non-py files, we need to specify them in <code>MANIFEST.in</code></p>
</div>
<p>The <a href="https://setuptools.pypa.io/en/latest/userguide/quickstart.html">doc</a> recommend users to expose as much as possible configuration in a more declarative way via the <code>pyproject.toml</code> or <code>setup.cfg</code>, and keep the <code>setup.py</code> minimal with only the dynamic parts (or even omit it completely if applicable).</p>
<div class="admonition info">
<p class="admonition-title">different dependency styles</p>
<p>Three types of dependency styles offered by setuptools: 1. build system requirement, 2. required dependency and 3. optional dependency. Build system requirement is what project replies on when building and packaging, such as <code>setuptools</code> and <code>pybind11</code>. Required dependency is what project replies on when running, such as <code>numpy</code>. Optional dependency is what project replies on when running, but not required, such as <code>matplotlib</code>. </p>
</div>
<p>In <code>setup.py</code>, we only need to write the dynamic parts. Before we introduce cpp extension, pure python project only need following two lines to run and test if you configure the <code>pyproject.toml</code> correctly:</p>
<pre><code class="language-python"># setup.py
from setuptools import setup

setup()
</code></pre>
<p>It is simple, right? It will be more complex when we introduce cpp extension. We will start to write, test and package our code in the next section.</p>
<h2 id="write-and-test">Write and Test</h2>
<pre><code>├── pyproject.toml  # and/or setup.cfg
├── setup.py
├── README.md  # ...and other optional declearation
├── src
│   └── mypkg
│       ├── __init__.py
│       ├── ...
│       ├── sum.py
|
└── tests
    ├── __init__.py
    ├── ...
    └── test_sum.py
</code></pre>
<p>We can write a simple function <code>py_add</code> in <code>src/my_proj/pyfunc.py</code>:</p>
<pre><code class="language-python">def py_add(a, b):
    return a + b
</code></pre>
<p>and a corresponding test case in <code>tests/test_py.py</code>:</p>
<pre><code class="language-python">from my_proj import py_add

def test_py_add():
    assert py_add(1, 2) == 3
</code></pre>
<p>We shoud import <code>my_proj</code> in a way that our user do. That means we SHOULD NOT import <code>my_proj</code> by a relative path from our current work directory(and don't use <code>sys.path.append</code> please), and that is <code>src-layout</code> prevent you to do so (The editor may not intelsense and find the package for not, it will be ok when project installed).
Once we need to run and test our code, we should install our package in editable mode:</p>
<pre><code class="language-bash">pip install -e .
# OR 
python -m pip install . --editable
</code></pre>
<p>In this way, we can mimic the package is installed in user's system and import it in a way that our user do. Also, as we make any change on <strong>python</strong> files, we do not need to re-install the package. For limitation of editable mode, please refer to <a href="https://setuptools.pypa.io/en/latest/userguide/development_mode.html">here</a>.</p>
<p>Once you have installed the package, you can run the test case by typing <code>pytest</code> in your terminal. Sometimes you want to test the code in different environment, such as different python version or different OS and so on. Those task may usually achieved by Github Action. Here we strongly recommand you to use <a href="https://tox.readthedocs.io/en/latest/">tox</a> to test your code in different environment. You can configure the test environment in <code>tox.ini</code>:</p>
<pre><code class="language-ini">[tox]
requires =
    tox&gt;=4
env_list = py{39, 310}

[testenv]
description = run the tests with pytest
package = wheel
wheel_build_env = .pkg
deps =
    pytest&gt;=7
    pytest-sugar
commands =
    pytest {tty:--color=yes} {posargs}

[testenv:lint]
description = run linters
skip_install = true
deps =
    black==22.12
commands = black {posargs:.}

[testenv:type]
description = run type checks
deps =
    mypy&gt;=0.991
commands =
    mypy {posargs:src tests}
</code></pre>
<p>As you can see, tox can execute different tasks in different environment. For example, <code>testenv</code> will run the test case in python 3.9 and 3.10, <code>lint</code> will run <code>black</code> to check the code style and <code>type</code> will run <code>mypy</code> to check the type. You can run the test by typing <code>tox</code> in your terminal. If you want to run only one task, you can type <code>tox -e lint</code> to run <code>lint</code> task only. For more information, please refer to <a href="https://tox.readthedocs.io/en/latest/">tox doc</a>.</p>
<h2 id="hybrid-python-and-cpp">Hybrid python and cpp</h2>
<p>As a modern python package, we always use cpp extension to accelerate our code. Here we will introduce how to use cpp extension in our package. We will use <a href="https://github.com/pybind/pybind11">pybind11</a>. </p>
<div class="admonition tip">
<p class="admonition-title">How to choose wapper</p>
<p>If your project is python-based, you can consider to use <code>cython</code>, <code>ctypes</code> or <code>cffi</code>;
If your project is cpp-based, you should choose <code>pybind11</code>
For more info, please refer to <a href="http://blog.behnel.de/posts/cython-pybind11-cffi-which-tool-to-choose.html">here</a></p>
</div>
<p>When using <code>pybind11</code>, we should separate the parts of building C++ projects and binding Python, namely </p>
<blockquote>
<p>Give back to Ceasar what is Ceasar's and to God what is God's</p>
</blockquote>
<p>This is the first principle we use <code>pybind11</code> and construct our project. We should write, test and build our cpp code without any distractions, and write the binding code in a separate file, at last bind them together. </p>
<p>We make a directory <code>cpp</code> in the root directory. You can either put <code>cpp</code> under <code>src</code> or in the root directory. Here we put it in the root directory. Our structure is like this:</p>
<pre><code>├── pyproject.toml  # and/or setup.cfg
├── setup.py
├── README.md  # ...and other optional declearation
├── cpp
│    ├── external  # c++ deps
│    ├── include  # headers
│    ├── src  # cpp source code
│    └── CMakeLists.txt
├── src
│   └── mypkg
│       ├── __init__.py
│       ├── ...
│       ├── sum.py
│
└── tests
    ├── __init__.py
    ├── ...
    └── test_sum.py

</code></pre>
<p>We add a simple function in <code>example</code>:</p>
<pre><code class="language-cpp">// example.h
int int_add(int, int);

// example.cpp
#include &quot;sum.h&quot;
int int_add(int i, int j) {
    return i + j;
}
</code></pre>
<p>Now we can consider it as a complete c++ project, and test it with such as <code>gtest</code>. Once the c++ part is flawless, we can write corresponding binding code in <code>bind_example.cpp</code> under <code>cpp</code> directory:</p>
<pre><code class="language-cpp">#include &lt;pybind11/pybind11.h&gt;
#include &quot;example.h&quot;

namespace py = pybind11;

PYBIND11_MODULE(cpp_kernel, m) {

    m.doc() = &quot;pybind11 example plugin&quot;; // optional module docstring

    m.def(&quot;int_add&quot;, &amp;int_add, &quot;A function which adds two numbers&quot;,
        py::arg(&quot;i&quot;), py::arg(&quot;j&quot;));

}
</code></pre>
<p>We now need to write <code>CMakeLists.txt</code>. First one is under root directory, and we write down some project-level configuration.</p>
<pre><code>cmake_minimum_required(VERSION 3.18)
project(modern_python_template)

message(STATUS &quot;Start to bind cpp code for modern_python_template&quot;)
add_subdirectory(cpp)
</code></pre>
<p>In <code>cpp</code>, we configure how to compile cpp code as a shared/static lib, and link it with python module. At last, we specify where the lib to install. </p>
<pre><code># --- compile cpp code as a shared lib and (optional)test it ---

# Use -fPIC even if statically compiled
set(CMAKE_POSITION_INDEPENDENT_CODE ON)

# If rely on external cpp submodule, 
# add_subdirectory()
# ... or compile it manually
add_library(
    cpp_core
    src/example.cpp
)

# Optional: set_target_properties
# Include directory of headers
target_include_directories(
    cpp_core
    PUBLIC
    ${CMAKE_CURRENT_SOURCE_DIR}/include
)

# --- compile python module ---
pybind11_add_module(cpp_kernel bind_example.cpp)
target_link_libraries(cpp_kernel PUBLIC cpp_core)

# --- Install libs so python module can import it ---

# Handle where to install the resulting Python package
if(CALL_FROM_SETUP_PY)
    # The CMakeExtension will set CMAKE_INSTALL_PREFIX to the root
    # of the resulting wheel archive
    set(KERNEL_INSTALL_PREFIX ${CMAKE_INSTALL_PREFIX})
else()
    # The Python package is installed directly in the folder of the
    # detected interpreter (system, user, or virtualenv)
    set(KERNEL_INSTALL_PREFIX ${Python3_SITELIB})
endif()

# Install the pybind11 library
install(
    TARGETS cpp_kernel
    # COMPONENT bindings
    LIBRARY DESTINATION ${KERNEL_INSTALL_PREFIX}
    ARCHIVE DESTINATION ${KERNEL_INSTALL_PREFIX}
    RUNTIME DESTINATION ${KERNEL_INSTALL_PREFIX}
)
</code></pre>
<p>In this work, we compile our cpp code as a static lib and link it to the python module. So we finally only need a python module which file name is <code>cpp_kernel.*.so</code>
 <a href="https://github.com/Roy-Kid/modern-python-template/blob/master/cpp/CMakeLists.txt"><code>CMakeLists.txt</code></a></p>
<p>One of the advantage of <code>Cython</code> is it asks developer wrap the c++ code, and call it in a more flexible way. Similarly, we can warp ours with a normal python function. We add a module (module is just normal <code>.py</code> file) under <code>src/my_project</code>:</p>
<pre><code class="language-python"># cppfunc.py
from my_project.cpp_kernel import int_add

def cpp_add(a, b):
    if isinstance(a, int) and isinstance(b, int):
        return int_add(a, b)
    # if a, b are not int, using other function
    # or convert them to int
    # (although float can be converted to int implicitly)
</code></pre>
<h2 id="references">References</h2>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>https://blog.ionelmc.ro/2014/05/25/python-packaging/#the-structure&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Roy Kid
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/Roy-Kid" target="_blank" rel="noopener" title="Roy&#39;s Github" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.top", "navigation.tabs", "header.autohide"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>